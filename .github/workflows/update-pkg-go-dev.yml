# .github/workflows/update-pkg-go-dev.yml
name: Trigger pkg.go.dev update

on:
  push:
    tags:
      - 'v*.*.*'  

jobs:
  trigger-pkg-go-dev:
    runs-on: ubuntu-latest
    steps:
      - name: Get tag name
        id: get_tag
        run: echo "TAG=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT

      - name: Wait a few seconds for Go proxy to catch up (optional but recommended)
        run: sleep 10

      - name: Trigger pkg.go.dev fetch
        env:
          MODULE_PATH: ${{ github.repository }}  
          TAG: ${{ steps.get_tag.outputs.TAG }}
        run: |
          URL="https://pkg.go.dev/${MODULE_PATH}@${TAG}"
          echo "Triggering pkg.go.dev update for: $URL"
          curl -sfL --retry 3 --retry-delay 5 "$URL" > /dev/null
          echo "âœ… Successfully triggered pkg.go.dev update."